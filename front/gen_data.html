<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>í†¡í†¡ ìƒë‹´ ERD ë°ì´í„° ìƒì„± Â· ë¯¸ë¦¬ë³´ê¸°</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #222;
    }
    .app {
      max-width: 1200px; margin: 40px auto; padding: 0 16px 40px;
    }
    .header {
      background: #fff; border-radius: 16px; padding: 24px 28px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08); border: 1px solid #eee;
    }
    .title { font-size: 22px; font-weight: 800; margin: 0 0 4px; }
    .desc { color: #666; font-size: 14px; }

    .controls {
      display: grid; grid-template-columns: repeat(4, minmax(160px, 1fr));
      gap: 16px; margin-top: 18px;
    }
    .control { display: flex; flex-direction: column; gap: 8px; }
    .control label { font-size: 13px; color: #555; }
    .control input {
      padding: 12px 12px; border: 2px solid #e9ecef; border-radius: 10px;
      font-size: 15px; outline: none;
    }
    .control input:focus { border-color: #667eea; }
    .actions { display: flex; align-items: center; gap: 10px; }

    .btn {
      padding: 12px 18px; border: none; border-radius: 10px;
      background: linear-gradient(135deg, #28a745, #20c997);
      color: #fff; font-weight: 700; cursor: pointer; transition: transform .15s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn.secondary {
      background: #f1f3f5; color: #333; font-weight: 600;
      border: 1px solid #e9ecef;
    }

    .stats {
      margin-top: 18px; display: grid; gap: 14px;
      grid-template-columns: repeat(4, minmax(120px, 1fr));
    }
    .stat {
      background:#fff; border:1px solid #eee; border-radius: 14px; padding: 16px 18px;
      display:flex; flex-direction:column; gap:6px; text-align:center;
      transition: transform .2s ease;
    }
    .stat:hover { transform: translateY(-3px); }
    .stat .num { font-size: 26px; font-weight: 800; color:#4c6ef5; }
    .stat .label { font-size: 12px; color:#666; }

    .tabs {
      margin-top: 18px; display: flex; gap: 6px; overflow-x: auto;
      background: #f8f9fa; border: 1px solid #eee; border-radius: 12px; padding: 6px;
    }
    .tab {
      background:#fff; border:1px solid #e9ecef; color:#333; padding:10px 14px;
      border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 13px;
    }
    .tab.active { background:#4c6ef5; color:#fff; border-color:#4c6ef5; }

    .panel {
      margin-top: 14px; background:#fff; border:1px solid #eee; border-radius: 12px; padding: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.06);
    }
    .panel h3 { margin: 6px 6px 12px; font-size: 16px; }

    .table-wrap { overflow:auto; border-radius: 10px; }
    table { width:100%; border-collapse: collapse; font-size: 13px; }
    th, td { border:1px solid #f1f3f5; padding:8px 10px; white-space: nowrap; }
    th { background:#f8f9fa; text-align:left; position: sticky; top: 0; }

    .downloads { margin-top: 16px; display:flex; flex-wrap: wrap; gap:8px; }
    .dl-btn {
      padding: 10px 12px; border-radius: 10px; border:1px solid #e9ecef; background:#fff;
      cursor: pointer; font-size: 13px; font-weight: 700;
    }
    .dl-btn.all { background:#4c6ef5; color:#fff; border-color:#4c6ef5; }
    .footer { margin-top: 14px; color:#777; font-size: 12px; }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title">í†¡í†¡ ìƒë‹´ ERD ë°ì´í„° ìƒì„± Â· ë¯¸ë¦¬ë³´ê¸°</div>
      <div class="desc">ERD ìŠ¤í‚¤ë§ˆ(consultants, customers, consultations, fund_types, documents, M:N ë¸Œë¦¿ì§€, ë¡œê·¸)ë¥¼ ë”°ë¥´ëŠ” ë”ë¯¸ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³ , í‘œë¡œ í™•ì¸Â·CSVë¡œ ë‚´ë ¤ë°›ì„ ìˆ˜ ìˆì–´ìš”.</div>

      <div class="controls">
        <div class="control">
          <label>ìƒë‹´ì‚¬ ìˆ˜ (consultants)</label>
          <input id="nConsultants" type="number" min="1" max="1000" value="50"/>
        </div>
        <div class="control">
          <label>ê³ ê° ìˆ˜ (customers)</label>
          <input id="nCustomers" type="number" min="1" max="50000" value="5000"/>
        </div>
        <div class="control">
          <label>ìƒë‹´ ìˆ˜ (consultations)</label>
          <input id="nConsultations" type="number" min="1" max="50000" value="30000"/>
        </div>
        <div class="actions">
          <button class="btn" onclick="generateData()">ë°ì´í„° ìƒì„±</button>
          <button class="btn secondary" onclick="clearData()">ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div class="stats">
        <div class="stat"><div class="num" id="sConsultants">0</div><div class="label">ìƒë‹´ì‚¬</div></div>
        <div class="stat"><div class="num" id="sCustomers">0</div><div class="label">ê³ ê°</div></div>
        <div class="stat"><div class="num" id="sConsultations">0</div><div class="label">ìƒë‹´</div></div>
        <div class="stat"><div class="num" id="sAvgSatisfaction">0.0</div><div class="label">í‰ê·  ë§Œì¡±ë„</div></div>
      </div>
    </div>

    <div class="tabs" id="tabs">
      <div class="tab active" data-tab="consultations" onclick="switchTab(event,'consultations')">ìƒë‹´</div>
      <div class="tab" data-tab="consultants" onclick="switchTab(event,'consultants')">ìƒë‹´ì‚¬</div>
      <div class="tab" data-tab="customers" onclick="switchTab(event,'customers')">ê³ ê°</div>
      <div class="tab" data-tab="fund_types" onclick="switchTab(event,'fund_types')">ìê¸ˆìœ í˜•</div>
      <div class="tab" data-tab="documents" onclick="switchTab(event,'documents')">ì„œë¥˜</div>
      <div class="tab" data-tab="consultation_fund_types" onclick="switchTab(event,'consultation_fund_types')">ìƒë‹´-ìê¸ˆìœ í˜•</div>
      <div class="tab" data-tab="consultation_documents" onclick="switchTab(event,'consultation_documents')">ìƒë‹´-ì„œë¥˜</div>
      <div class="tab" data-tab="conversation_logs" onclick="switchTab(event,'conversation_logs')">ìƒë‹´ë¡œê·¸</div>
    </div>

    <div class="panel">
      <div id="tableTitle"></div>
      <div class="table-wrap" id="tableWrap"><p style="padding:8px 6px;color:#777">ë°ì´í„°ë¥¼ ìƒì„±í•˜ë©´ í‘œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p></div>

      <div class="downloads">
        <button class="dl-btn" onclick="downloadCSV('consultants')">ğŸ‘¨â€ğŸ’¼ ìƒë‹´ì‚¬</button>
        <button class="dl-btn" onclick="downloadCSV('customers')">ğŸ‘¥ ê³ ê°</button>
        <button class="dl-btn" onclick="downloadCSV('consultations')">ğŸ’¬ ìƒë‹´</button>
        <button class="dl-btn" onclick="downloadCSV('fund_types')">ğŸ’° ìê¸ˆìœ í˜•</button>
        <button class="dl-btn" onclick="downloadCSV('documents')">ğŸ“‹ ì„œë¥˜</button>
        <button class="dl-btn" onclick="downloadCSV('consultation_fund_types')">ğŸ”— ìƒë‹´-ìê¸ˆìœ í˜•</button>
        <button class="dl-btn" onclick="downloadCSV('consultation_documents')">ğŸ” ìƒë‹´-ì„œë¥˜</button>
        <button class="dl-btn" onclick="downloadCSV('conversation_logs')">ğŸ“ ìƒë‹´ë¡œê·¸</button>
        <button class="dl-btn all" onclick="downloadAll()">ğŸ“¦ ì „ì²´ CSV</button>
      </div>
      <div class="footer">â€» í‘œëŠ” ìµœëŒ€ 200í–‰ë§Œ ë¯¸ë¦¬ë³´ê¸°ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤. CSVì—ëŠ” ì „ì²´ê°€ ì €ì¥ë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script>
    // ì „ì—­ ì €ì¥ì†Œ (í…Œì´ë¸”ëª…ì€ DB ìŠ¤í‚¤ë§ˆì™€ ë™ì¼í•˜ê²Œ ìœ ì§€)
    const store = {
      consultants: [],
      customers: [],
      fund_types: [],
      documents: [],
      consultations: [],
      consultation_fund_types: [],
      consultation_documents: [],
      conversation_logs: []
    };

    // ìƒ˜í”Œ ì‚¬ì „ ë°ì´í„°
    const departments = ["ì •ì±…ìê¸ˆ", "ì†Œìƒê³µì¸", "ë¯¼ì›ìƒë‹´", "ì¼ë°˜ìƒë‹´", "ì „ë¬¸ìƒë‹´"];
    const majors = ["ê²½ì˜í•™", "ê²½ì œí•™", "ì •ë³´ë³´í˜¸", "ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤", "í–‰ì •í•™", "í†µê³„í•™", "ë²•í•™"];
    const teams = ["AíŒ€", "BíŒ€", "CíŒ€"];
    const regions = ["ì„œìš¸", "ê²½ê¸°", "ì¸ì²œ", "ë¶€ì‚°", "ëŒ€êµ¬", "ê´‘ì£¼", "ëŒ€ì „", "ìš¸ì‚°", "ê°•ì›", "ì¶©ë¶", "ì¶©ë‚¨", "ì „ë¶", "ì „ë‚¨", "ê²½ë¶", "ê²½ë‚¨", "ì œì£¼"];
    const businessTypes = ["ì œì¡°ì—…","ë„ì†Œë§¤","ìŒì‹ì ","ì¹´í˜","ìƒí™œì„œë¹„ìŠ¤","ITì„œë¹„ìŠ¤","êµìœ¡ì„œë¹„ìŠ¤","ìš´ìˆ˜ì—…","ì¶œíŒ/ì¸ì‡„","ë†ì—…"];
    const fundTypeNames = [
      "ìš´ì „ìê¸ˆ-ë§¤ì¶œì±„ê¶Œë‹´ë³´", "ìš´ì „ìê¸ˆ-ì†Œìƒê³µì¸",
      "ì°½ì—…-ì´ˆê¸°ì°½ì—…", "ì°½ì—…-ì¬ì°½ì—…", "ìŠ¤ë§ˆíŠ¸ê³µì¥", "ìŠ¤ë§ˆíŠ¸ê¸°ìˆ ", "ì¼ë°˜í˜•-ë°±ë…„ê°€ê²Œ",
      "ì¼ë°˜í˜•-ì‚¬íšŒì ê²½ì œê¸°ì—…", "ì¼ë°˜í˜•-ì‹ ì‚¬ì—…ì‚¬ê´€í•™êµ"
    ];
    const documentNames = [
      "ëŒ€ì¶œì‹ ì²­ì„œ","ì‚¬ì—…ìë“±ë¡ì¦ëª…","í‘œì¤€ì¬ë¬´ì œí‘œì¦ëª…","ë‚©ì„¸ì¦ëª…ì„œ","ì§€ë°©ì„¸ë‚©ì„¸ì¦ëª…ì„œ",
      "ê±´ê°•ë³´í—˜ê°€ì…ìë³„ë¶€ê³¼í˜„í™©","ì£¼ë¯¼ë“±ë¡í‘œë“±ë³¸","ë“±ê¸°ì‚¬í•­ì „ë¶€ì¦ëª…ì„œ","ì„ëŒ€ì°¨ê³„ì•½ì„œ","ì‚¬ì—…ê³„íšì„œ"
    ];
    const resolutionTypes = ["ì™„ë£Œ","ë³´ë¥˜","ì´ê´€","ë°˜ë ¤"];
    const logTypes = ["ìƒì„±","ë°°ì •","ì„œë¥˜ìš”ì²­","ì„œë¥˜ì ‘ìˆ˜","ê²€ì¦","ì¢…ë£Œ"];
    const statuses = ["ì§„í–‰ì¤‘","ì™„ë£Œ","ëŒ€ê¸°","ë³´ë¥˜"];
    const genders = ["ë‚¨","ì—¬"];
    const r = (n)=>Math.floor(Math.random()*n);

    function randPick(arr){ return arr[r(arr.length)]; }
    function pad2(n){ return String(n).padStart(2,"0"); }
    
    // ì£¼ë§ ì²´í¬ í•¨ìˆ˜
    function isWeekend(date) {
      const day = date.getDay();
      return day === 0 || day === 6; // ì¼ìš”ì¼(0) ë˜ëŠ” í† ìš”ì¼(6)
    }
    
    // ê·¼ë¬´ì‹œê°„ ë‚´ ëœë¤ ì‹œê°„ ìƒì„± (ì ì‹¬ í›„ ê°€ì¤‘ì¹˜ ì ìš©)
    function getBusinessHour() {
      const weights = [
        // 9ì‹œ-12ì‹œ: ê¸°ë³¸ ê°€ì¤‘ì¹˜
        1, 1, 1, 1, // 9, 10, 11, 12ì‹œ
        // 13ì‹œ-15ì‹œ: ì ì‹¬ í›„ ë†’ì€ ê°€ì¤‘ì¹˜
        3, 3, 3, // 13, 14, 15ì‹œ
        // 16ì‹œ-17ì‹œ: ê¸°ë³¸ ê°€ì¤‘ì¹˜
        1, 1 // 16, 17ì‹œ
      ];
      
      const totalWeight = weights.reduce((sum, w) => sum + w, 0);
      let random = Math.random() * totalWeight;
      
      for (let i = 0; i < weights.length; i++) {
        random -= weights[i];
        if (random <= 0) {
          return 9 + i; // 9ì‹œë¶€í„° ì‹œì‘
        }
      }
      return 14; // ê¸°ë³¸ê°’ (ì ì‹¬ í›„)
    }
    
    // ê·¼ë¬´ì¼ ë‚´ ëœë¤ ë‚ ì§œ/ì‹œê°„ ìƒì„±
    function dateTimeBetweenBusiness(start, end) {
      let attempts = 0;
      const maxAttempts = 100;
      
      while (attempts < maxAttempts) {
        const s = new Date(start).getTime();
        const e = new Date(end).getTime();
        const t = s + Math.random() * (e - s);
        const randomDate = new Date(t);
        
        // ì£¼ë§ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì§„í–‰
        if (!isWeekend(randomDate)) {
          // ê·¼ë¬´ì‹œê°„ ì„¤ì •
          const hour = getBusinessHour();
          const minute = r(60);
          const second = r(60);
          
          randomDate.setHours(hour, minute, second);
          return randomDate;
        }
        attempts++;
      }
      
      // ë§Œì•½ 100ë²ˆ ì‹œë„í•´ë„ í‰ì¼ì„ ëª» ì°¾ìœ¼ë©´ ê°•ì œë¡œ í‰ì¼ ìƒì„±
      const s = new Date(start).getTime();
      const e = new Date(end).getTime();
      const t = s + Math.random() * (e - s);
      const fallbackDate = new Date(t);
      
      // ì£¼ë§ì´ë©´ ë‹¤ìŒ ì›”ìš”ì¼ë¡œ ë³€ê²½
      while (isWeekend(fallbackDate)) {
        fallbackDate.setDate(fallbackDate.getDate() + 1);
      }
      
      const hour = getBusinessHour();
      const minute = r(60);
      const second = r(60);
      fallbackDate.setHours(hour, minute, second);
      
      return fallbackDate;
    }
    
    function dateBetween(start, end){
      const s = new Date(start).getTime();
      const e = new Date(end).getTime();
      const t = s + Math.random()*(e-s);
      return new Date(t);
    }
    
    function fmtDate(d){
      const y=d.getFullYear(), m=pad2(d.getMonth()+1), day=pad2(d.getDate());
      return `${y}-${m}-${day}`;
    }
    function fmtDateTime(d){
      const y=d.getFullYear(), m=pad2(d.getMonth()+1), day=pad2(d.getDate());
      const hh=pad2(d.getHours()), mm=pad2(d.getMinutes()), ss=pad2(d.getSeconds());
      return `${y}-${m}-${day} ${hh}:${mm}:${ss}`;
    }
    function phone(){
      return `010-${pad2(r(90)+10)}${pad2(r(10))}-${pad2(r(90)+10)}${pad2(r(10))}`;
    }
    function nameKR(){
      const s = ["ê¹€","ì´","ë°•","ìµœ","ì •","ê°•","ì¡°","ìœ¤","ì¥","ì„","í•œ","ì˜¤","ì„œ","ì‹ ","ê¶Œ","í™©","ì•ˆ","ì†¡","ë¥˜","ì „"];
      const g = ["ë¯¼ìˆ˜","ì˜í¬","ì² ìˆ˜","ì˜ìˆ˜","ì§€ë¯¼","ì§€ì—°","ë„í˜„","ìœ ë‚˜","ì„±ë¯¼","í•˜ì€","ì„œì¤€","ì„œì—°","ì§€ìš°","í˜„ìš°","ì„œí˜„","ì—°ìš°","ì¤€í˜¸","ì§€ì˜","ë™í˜„","ìˆ˜ì§„"];
      return s[r(s.length)] + g[r(g.length)];
    }

    function clearData(){
      Object.keys(store).forEach(k => store[k] = []);
      updateStats();
      renderTable("consultations");
    }

    function generateData(){
      clearData();
      const nCns = parseInt(document.getElementById("nConsultants").value || "50", 10);
      const nCus = parseInt(document.getElementById("nCustomers").value || "5000", 10);
      const nCon = parseInt(document.getElementById("nConsultations").value || "30000", 10);

      console.log("ë°ì´í„° ìƒì„± ì‹œì‘:", nCns, "ìƒë‹´ì‚¬,", nCus, "ê³ ê°,", nCon, "ìƒë‹´");

      // consultants
      for(let i=1;i<=nCns;i++){
        const join = dateBetween("2022-01-01","2025-08-01");
        store.consultants.push({
          consultant_id: i,
          name: nameKR(),
          department: randPick(departments),
          major: randPick(majors),
          join_date: fmtDate(join),
          team: randPick(teams)
        });
      }

      // customers
      for(let i=1;i<=nCus;i++){
        store.customers.push({
          customer_id: i,
          age: 20 + r(41),
          gender: randPick(genders),
          name: nameKR(),
          region: randPick(regions),
          phone_number: phone(),
          business_type: randPick(businessTypes)
        });
      }

      // fund_types
      for(let i=1;i<=fundTypeNames.length;i++){
        store.fund_types.push({
          fund_type_id: i,
          fund_type_name: fundTypeNames[i-1]
        });
      }

      // documents
      for(let i=1;i<=documentNames.length;i++){
        const req = Math.random()<0.7;
        const sub = req ? Math.random()<0.6 : false;
        store.documents.push({
          document_id: i,
          document_name: documentNames[i-1],
          is_required: req,
          is_submitted: sub,
          submission_date: sub ? fmtDate(dateBetween("2025-01-01","2025-08-25")) : null
        });
      }

      // consultations + bridges + logs (6ê°œì›” ì´ìƒ ë°ì´í„° ìƒì„±)
      console.log("ìƒë‹´ ë°ì´í„° ìƒì„± ì¤‘...");
      for(let i=1;i<=nCon;i++){
        const consultant_id = r(nCns)+1;
        const customer_id = r(nCus)+1;
        
        // ê·¼ë¬´ì‹œê°„ ë‚´ ì‹œì‘ ì‹œê°„ ìƒì„± (6ê°œì›” ì´ìƒ ê¸°ê°„ìœ¼ë¡œ í™•ì¥)
        const start = dateTimeBetweenBusiness("2025-01-01","2025-08-25");
        const durMin = 5 + r(40); // 5~45ë¶„
        const end = new Date(start.getTime() + durMin*60*1000);
        const satisfaction = 3 + r(3); // 3~5ì  ìœ„ì£¼

        store.consultations.push({
          consultation_id: i,
          consultant_id, customer_id,
          start_time: fmtDateTime(start),
          end_time: fmtDateTime(end),
          consultation_date: fmtDate(start),
          resolution_type: randPick(resolutionTypes),
          satisfaction_score: satisfaction
        });

        // ìƒë‹´-ìê¸ˆìœ í˜• (1~2ê°œ í›„ë³´)
        const fundCount = 1 + r(2);
        const chosen = new Set();
        for(let k=0;k<fundCount;k++){
          const ft = r(store.fund_types.length)+1;
          if(chosen.has(ft)) continue;
          chosen.add(ft);
          store.consultation_fund_types.push({
            consultation_id: i,
            fund_type_id: ft
          });
        }

        // ìƒë‹´-ì„œë¥˜ (2~5ê°œ ìš”êµ¬)
        const docCount = 2 + r(4);
        const chosenDoc = new Set();
        for(let k=0;k<docCount;k++){
          const d = r(store.documents.length)+1;
          if(chosenDoc.has(d)) continue;
          chosenDoc.add(d);
          store.consultation_documents.push({
            consultation_id: i,
            document_id: d
          });
        }

        // ìƒë‹´ë¡œê·¸ (3~8ê°œ)
        const logCnt = 3 + r(6);
        for(let k=1;k<=logCnt;k++){
          const logTime = dateTimeBetweenBusiness(start, end);
          store.conversation_logs.push({
            log_id: (i-1)*8 + k,
            consultation_id: i,
            timestamp: fmtDateTime(logTime),
            log_type: randPick(logTypes),
            status: randPick(statuses),
            created_at: fmtDateTime(new Date())
          });
        }

        // ì§„í–‰ìƒí™© í‘œì‹œ (ëŒ€ëŸ‰ ë°ì´í„° ìƒì„±ì‹œ)
        if (i % 1000 === 0) {
          console.log(`${i}/${nCon} ìƒë‹´ ìƒì„± ì™„ë£Œ`);
        }
      }

      console.log("ë°ì´í„° ìƒì„± ì™„ë£Œ");
      updateStats();
      renderTable(getActiveTab());
    }

    function updateStats(){
      const avgSat = store.consultations.length
        ? (store.consultations.reduce((s,c)=>s+(c.satisfaction_score||0),0) / store.consultations.length).toFixed(1)
        : "0.0";
      document.getElementById("sConsultants").textContent = store.consultants.length.toLocaleString();
      document.getElementById("sCustomers").textContent = store.customers.length.toLocaleString();
      document.getElementById("sConsultations").textContent = store.consultations.length.toLocaleString();
      document.getElementById("sAvgSatisfaction").textContent = avgSat;
    }

    function getActiveTab(){
      const active = document.querySelector(".tab.active");
      return active ? active.dataset.tab : "consultations";
    }
    function switchTab(e, name){
      document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
      e.target.classList.add("active");
      renderTable(name);
    }

    function renderTable(name){
      const wrap = document.getElementById("tableWrap");
      const titleEl = document.getElementById("tableTitle");
      let data = [];
      let title = "";
      switch(name){
        case "consultations": data = store.consultations; title="ğŸ’¬ ìƒë‹´ (consultations)"; break;
        case "consultants": data = store.consultants; title="ğŸ‘¨â€ğŸ’¼ ìƒë‹´ì‚¬ (consultants)"; break;
        case "customers": data = store.customers; title="ğŸ‘¥ ê³ ê° (customers)"; break;
        case "fund_types": data = store.fund_types; title="ğŸ’° ìê¸ˆìœ í˜• (fund_types)"; break;
        case "documents": data = store.documents; title="ğŸ“‹ ì„œë¥˜ (documents)"; break;
        case "consultation_fund_types": data = store.consultation_fund_types; title="ğŸ”— ìƒë‹´-ìê¸ˆìœ í˜•"; break;
        case "consultation_documents": data = store.consultation_documents; title="ğŸ” ìƒë‹´-ì„œë¥˜"; break;
        case "conversation_logs": data = store.conversation_logs; title="ğŸ“ ìƒë‹´ë¡œê·¸"; break;
      }
      titleEl.innerHTML = `<h3>${title} <small style="color:#777;font-weight:600">(${data.length.toLocaleString()} rows)</small></h3>`;
      if(!data || data.length===0){
        wrap.innerHTML = `<p style="padding:8px 6px;color:#777">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì˜ "ë°ì´í„° ìƒì„±"ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>`;
        return;
      }
      const headers = Object.keys(data[0]);
      const rows = data.slice(0,200).map(row =>
        `<tr>${headers.map(h=>`<td>${row[h]!==undefined && row[h]!==null ? String(row[h]).replace(/&/g,"&amp;").replace(/</g,"&lt;") : ""}</td>`).join("")}</tr>`
      ).join("");
      wrap.innerHTML = `<div class="table-wrap"><table>
        <thead><tr>${headers.map(h=>`<th>${h}</th>`).join("")}</tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
    }

    // CSV
    function toCSV(arr){
      if(!arr || arr.length===0) return "";
      const headers = Object.keys(arr[0]);
      const esc = v => {
        const s = (v===undefined || v===null) ? "" : String(v);
        if (/[",\n]/.test(s)) return `"${s.replace(/"/g,'""')}"`;
        return s;
      };
      const lines = [headers.join(",")];
      for(const row of arr){
        lines.push(headers.map(h=>esc(row[h])).join(","));
      }
      return lines.join("\n");
    }
    function downloadBlob(content, filename, type="text/csv;charset=utf-8"){
      const blob = new Blob([content], {type});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }
    function downloadCSV(name){
      const map = {
        consultants: store.consultants,
        customers: store.customers,
        consultations: store.consultations,
        fund_types: store.fund_types,
        documents: store.documents,
        consultation_fund_types: store.consultation_fund_types,
        consultation_documents: store.consultation_documents,
        conversation_logs: store.conversation_logs
      };
      const data = map[name] || [];
      if(!data.length){ alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € 'ë°ì´í„° ìƒì„±'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”."); return; }
      downloadBlob(toCSV(data), name + ".csv");
    }
    function downloadAll(){
      const files = [
        ["consultants", store.consultants],
        ["customers", store.customers],
        ["consultations", store.consultations],
        ["fund_types", store.fund_types],
        ["documents", store.documents],
        ["consultation_fund_types", store.consultation_fund_types],
        ["consultation_documents", store.consultation_documents],
        ["conversation_logs", store.conversation_logs]
      ];
      if(!files.some(([_,arr])=>arr.length)){ alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € 'ë°ì´í„° ìƒì„±'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”."); return; }
      for(const [name, arr] of files){
        if(arr.length) downloadBlob(toCSV(arr), name + ".csv");
      }
    }

    // ì´ˆê¸° ë Œë”
    renderTable("consultations");
  </script>
</body>
</html>